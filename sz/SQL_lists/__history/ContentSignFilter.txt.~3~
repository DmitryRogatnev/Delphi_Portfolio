Join (  Select p.Doc_Rout_Id
From   Src.v_Doc_Rout_Points p
Left   Join Src.v_Doc_Rout_Point_Pstns ps
On     ps.Doc_Rout_Point_Id=p.Id_Doc_Rout_Point
Left   Join Src.v_Doc_Rout_Point_Pstn_Ds dps
On     dps.Doc_Rout_Point_Pstn_Id=ps.Id_Doc_Rout_Point_Pstn
Left   Join Src.v_Doc_Rout_Point_Pstn_Us ups
On     ups.DOC_ROUT_POINT_PSTN_ID=ps.Id_Doc_Rout_Point_Pstn
Join   Stp.v_Dep_Mmbrs dm
On     ((dm.dep_Id=dps.Dep_Id And dm.dep_Mmbr_Pstn_Id=ps.Dep_Mmbr_Pstn_Id)
				 or  dm.User_Id=ups.USER_ID)
	     And dm.User_Id=User
Join (Select Count(pp.Result_Date)/Count(c.P_DOC_ROUT_POINT_ID) Signed_Points,
                    (Case
                      When Max(Nvl(pp.Result_Date, to_Date('01.01.0001')))=to_Date('01.01.0001')
                      Then Null
                      Else Max(pp.Result_Date)
                    End) Date_In,
                    c.C_DOC_ROUT_POINT_ID
             From   Src.v_Doc_Rout_Point_Cnnctns c
						 Left   Join Src.v_Doc_Rout_Points pp
						 On     pp.Id_Doc_Rout_Point=c.P_DOC_ROUT_POINT_ID
                    And pp.Stp_Doc_Resolution_Result_Id Is Not Null
										And pp.Stp_Doc_Resolution_Result_Id <>0
						 Group  By c.C_DOC_ROUT_POINT_ID
						 Union  All
						 Select 1, r.Date_Start_Route, p.Id_Doc_Rout_Point
						 From   Src.v_Doc_Rout_Points p
						 Join   Src.v_Doc_Routs r
						 On     r.Doc_Header_Id=p.Doc_Rout_Id
						        And Instr(p.Point_Position, '1.')<>0  ) c
On    c.C_DOC_ROUT_POINT_ID=p.Id_Doc_Rout_Point
      And c.Signed_Points=1
Group  By p.Doc_Rout_Id) p
On p.Doc_Rout_Id=t.Doc_Header_Id
/*BeginFilter*/Where (1=1)/*EndFilter*/